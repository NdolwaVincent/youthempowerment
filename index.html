<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Youth Empowerment Admin Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import { getDatabase, ref, get, child } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBtB199eH6fONCftI_B6IDP80_0Tv2dFN8",
      authDomain: "m-sales-45b35.firebaseapp.com",
      databaseURL: "https://m-sales-45b35-default-rtdb.firebaseio.com",
      projectId: "m-sales-45b35",
      storageBucket: "m-sales-45b35.appspot.com",
      messagingSenderId: "194892525308",
      appId: "1:194892525308:web:c01af3028c85abdb97f179"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const maskID = (id) => {
      if (!id || id.length < 8) return id;
      return id.slice(0, 4) + "****" + id.slice(-3);
    };

    const loadData = async () => {
      const dbRef = ref(db);
      const voterTable = document.getElementById("voterBody");
      const aspirantTable = document.getElementById("aspirantBody");
      const voterCount = document.getElementById("voterCount");
      const aspirantCount = document.getElementById("aspirantCount");

      const voterSnap = await get(child(dbRef, "Youth/Chama/Voting/voters"));
      const aspirantSnap = await get(child(dbRef, "Youth/Chama/Voting/aspirants"));

      voterTable.innerHTML = "";
      aspirantTable.innerHTML = "";

      let voters = [];
      let aspirants = [];

      if (voterSnap.exists()) {
        voters = Object.values(voterSnap.val());
        voters.forEach((v, i) => {
          voterTable.innerHTML += `
            <tr class="border-b">
              <td class="p-2">${i + 1}</td>
              <td class="p-2">${v.name}</td>
              <td class="p-2">${v.phone}</td>
              <td class="p-2">${maskID(v.id)}</td>
              <td class="p-2"><img src="${v.imageUrl}" class="w-12 h-12 rounded-full object-cover" /></td>
            </tr>`;
        });
      }

      if (aspirantSnap.exists()) {
        aspirants = Object.values(aspirantSnap.val());
        aspirants.forEach((a, i) => {
          aspirantTable.innerHTML += `
            <tr class="border-b">
              <td class="p-2">${i + 1}</td>
              <td class="p-2">${a.name}</td>
              <td class="p-2">${a.phone}</td>
              <td class="p-2">${maskID(a.id)}</td>
              <td class="p-2">${a.seat}</td>
              <td class="p-2"><img src="${a.imageUrl}" class="w-12 h-12 rounded-full object-cover" /></td>
            </tr>`;
        });
      }

      // Update counts
      voterCount.textContent = voters.length;
      aspirantCount.textContent = aspirants.length;
    };

    document.addEventListener("DOMContentLoaded", loadData);
  </script>
</head>
<body class="bg-gray-100 p-4 min-h-screen">
  <div class="max-w-6xl mx-auto">
    <h1 class="text-3xl font-bold text-center mb-6 text-blue-700">Youth Empowerment Admin Dashboard</h1>

    <!-- Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-8">
      <div class="bg-white shadow rounded-lg p-6 text-center">
        <h2 class="text-lg font-semibold text-gray-700">Total Voters</h2>
        <p id="voterCount" class="text-3xl font-bold text-green-600 mt-2">0</p>
      </div>
      <div class="bg-white shadow rounded-lg p-6 text-center">
        <h2 class="text-lg font-semibold text-gray-700">Total Aspirants</h2>
        <p id="aspirantCount" class="text-3xl font-bold text-purple-600 mt-2">0</p>
      </div>
    </div>

    <!-- Voters Table -->
    <div class="bg-white shadow rounded-lg p-6 mb-10 overflow-x-auto">
      <h2 class="text-xl font-semibold mb-4 text-green-700">Voter Registrations</h2>
      <table class="min-w-full text-left text-sm">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">#</th>
            <th class="p-2">Name</th>
            <th class="p-2">Phone</th>
            <th class="p-2">National ID</th>
            <th class="p-2">Photo</th>
          </tr>
        </thead>
        <tbody id="voterBody" class="bg-white"></tbody>
      </table>
    </div>

    <!-- Aspirants Table -->
    <div class="bg-white shadow rounded-lg p-6 overflow-x-auto">
      <h2 class="text-xl font-semibold mb-4 text-purple-700">Aspirant Registrations</h2>
      <table class="min-w-full text-left text-sm">
        <thead>
          <tr class="bg-gray-200">
            <th class="p-2">#</th>
            <th class="p-2">Name</th>
            <th class="p-2">Phone</th>
            <th class="p-2">National ID</th>
            <th class="p-2">Seat</th>
            <th class="p-2">Photo</th>
          </tr>
        </thead>
        <tbody id="aspirantBody" class="bg-white"></tbody>
      </table>
    </div>
  </div>
</body>
</html>
